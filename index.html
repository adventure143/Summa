<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 600px; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        footer { margin-top: 30px; text-align: center; color: #6c757d; }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="mb-4 text-center">Add New ID Profile</h1>
        <div id="message-area" class="mb-3"></div>

        <form id="add-profile-form">
            <div class="mb-3">
                <label for="image-url" class="form-label">Image URL</label>
                <input type="url" class="form-control" id="image-url" placeholder="https://example.com/image.jpg" required>
                <small class="form-text text-muted">Paste the full web address of the image.</small>
            </div>

            <div class="row mb-3">
               <div class="col-md-6">
                    <label for="id-level" class="form-label">ID Level</label>
                    <input type="text" class="form-control" id="id-level" required>
                </div>
                <div class="col-md-6">
                    <label for="group-level" class="form-label">Group Level</label>
                    <input type="text" class="form-control" id="group-level" required>
                </div>
            </div>

            <div class="mb-3">
                <label for="price" class="form-label">Price</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" min="0" class="form-control" id="price" required>
                </div>
            </div>

            <div class="d-grid gap-2">
                 <button type="submit" class="btn btn-primary">Add Profile to List</button>
                 <!-- **** LINK UPDATED TO POINT TO VIEWING PAGE **** -->
                 <a href="profiles.html" class="btn btn-secondary">View Saved Profiles</a>
                 <!-- **** LINK UPDATED TO POINT TO VIEWING PAGE **** -->
            </div>
        </form>
    </div>

    <footer>
        <p>Â© 2023 Simple Data Entry</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('add-profile-form');
            const messageArea = document.getElementById('message-area');

            // --- Function to show messages ---
            function showMessage(message, type = 'success') {
                messageArea.innerHTML = `<div class="alert alert-${type}" role="alert">${escapeHtml(message)}</div>`;
                 // Optional: Clear message after a few seconds
                setTimeout(() => {
                   if(messageArea) messageArea.innerHTML = '';
                }, 3000);
            }

             // --- Simple HTML escaping helper ---
             function escapeHtml(unsafe) {
               if (typeof unsafe !== 'string') {
                   if (unsafe === null || unsafe === undefined) return '';
                    unsafe = String(unsafe);
               }
               return unsafe
                   .replace(/&/g, "&")
                   .replace(/</g, "<")
                   .replace(/>/g, ">")
                   .replace(/"/g, """)
                   .replace(/'/g, "'");
             }

            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Stop page reload

                // --- Get data from form ---
                const newProfile = {
                    imageUrl: document.getElementById('image-url').value.trim(),
                    idLevel: document.getElementById('id-level').value.trim(),
                    groupLevel: document.getElementById('group-level').value.trim(),
                    price: parseFloat(document.getElementById('price').value),
                    // Add a unique ID based on timestamp for simplicity
                    id: 'profile_' + Date.now()
                };

                // --- Basic Validation ---
                if (!newProfile.imageUrl || !newProfile.idLevel || !newProfile.groupLevel || isNaN(newProfile.price) || newProfile.price < 0) {
                    showMessage("Please fill in all fields correctly.", 'danger');
                    return;
                }
                 try { // Basic URL check
                     new URL(newProfile.imageUrl);
                 } catch (_) {
                     showMessage("Invalid Image URL format.", "warning");
                     return;
                 }

                // --- Load existing profiles from localStorage ---
                let profiles = [];
                const storedProfiles = localStorage.getItem('digitalIdProfiles');
                if (storedProfiles) {
                    try {
                        profiles = JSON.parse(storedProfiles);
                        // Ensure it's an array
                        if (!Array.isArray(profiles)) {
                            console.warn("Stored data was not an array, resetting.");
                            profiles = [];
                        }
                    } catch (e) {
                        console.error("Error parsing stored profiles:", e);
                        showMessage("Could not load existing data. Starting fresh.", "warning");
                        profiles = []; // Start fresh if stored data is corrupted
                    }
                }

                // --- Add new profile ---
                profiles.push(newProfile);

                // --- Save updated list back to localStorage ---
                try {
                    localStorage.setItem('digitalIdProfiles', JSON.stringify(profiles));
                    showMessage(`Profile added successfully! (Level: ${escapeHtml(newProfile.idLevel)})`, 'success');
                    form.reset(); // Clear the form
                    document.getElementById('image-url').focus(); // Focus first field again
                } catch (e) {
                     console.error("Error saving data to localStorage:", e);
                     showMessage("Could not save data. Local storage might be full or disabled.", "danger");
                }
            });
        });
    </script>
     <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
